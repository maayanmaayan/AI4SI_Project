[2026-01-20 03:40:59] [INFO] [experiment] Starting training
[2026-01-20 03:40:59] [INFO] [experiment] Using device: mps
[2026-01-20 03:40:59] [INFO] [experiment] Loading features from data/processed/features/compliant
[2026-01-20 03:40:59] [INFO] [src.training.dataset] Found 7 target_points.parquet files in data/processed/features/compliant
[2026-01-20 03:41:00] [INFO] [src.training.dataset] Combined 3636 total rows from 7 files, 7 unique neighborhoods
[2026-01-20 03:41:00] [INFO] [src.training.dataset] Created splits: Train=1844 rows (4 neighborhoods), Val=308 rows (1 neighborhoods), Test=1484 rows (2 neighborhoods)
[2026-01-20 03:41:00] [INFO] [experiment] Calculating class weights from training dataset...
[2026-01-20 03:41:00] [INFO] [experiment] Class counts: [487, 60, 478, 208, 27, 64, 479, 41]
[2026-01-20 03:41:00] [INFO] [experiment] Class weights (before damping): [3.786447525024414, 30.733333587646484, 3.857740640640259, 8.865385055541992, 68.29629516601562, 28.8125, 3.849686861038208, 44.975608825683594]
[2026-01-20 03:41:00] [INFO] [experiment] Class weights (after sqrt damping and capping at 3.0): [1.945879578590393, 3.0, 1.9641132354736328, 2.9774796962738037, 3.0, 3.0, 1.962061882019043, 3.0]
[2026-01-20 03:41:00] [INFO] [experiment] Data augmentation enabled: feature_noise (p=0.8, std=0.01), neighbor_subsampling (p=0.5, ratio=0.8), edge_noise (p=0.3, std=0.02)
[2026-01-20 03:41:00] [INFO] [experiment] Computing true class distribution from training dataset...
[2026-01-20 03:41:02] [INFO] [experiment] True distribution: ['0.1571', '0.0913', '0.1712', '0.1383', '0.0718', '0.0792', '0.1926', '0.0985']
[2026-01-20 03:41:02] [INFO] [experiment] Created datasets: Train=1844, Val=308, Test=1484
[2026-01-20 03:41:02] [INFO] [src.training.model] Created SpatialGraphTransformer: 47,752 parameters
[2026-01-20 03:41:02] [INFO] [experiment] Loss function: label_smoothing=0.0, class_weights capped at 3.0, entropy_weight=5.0, min_entropy=1.5, entropy_penalty_type=linear, maxsup_weight=0.1, maxsup_threshold=0.0
[2026-01-20 03:41:02] [INFO] [experiment] Optimizer: using separate weight decay - base=0.001, final_layer=0.011
[2026-01-20 03:41:02] [INFO] [experiment] Initialized prediction distribution file: /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/prediction_distributions.json
[2026-01-20 03:41:02] [INFO] [experiment] Starting training loop
[2026-01-20 03:57:30] [INFO] [experiment] Epoch 1/30 (988.71s): train_loss=0.7388, train_top1=0.0163, train_top3=0.8308, val_loss=0.5566, val_kl=0.2410, val_top1=0.0260, val_top3=0.8409
[2026-01-20 03:57:55] [INFO] [experiment] Computing prediction distribution for epoch 1...
[2026-01-20 03:58:09] [INFO] [experiment] Epoch 1 prediction distribution: ['0.1031', '0.1456', '0.1677', '0.1091', '0.1787', '0.0656', '0.0825', '0.1476']
[2026-01-20 03:58:09] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/prediction_distributions.json
[2026-01-20 03:58:09] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 03:58:09] [INFO] [experiment] New best validation loss: 0.5566 (patience counter reset to 0)
[2026-01-20 03:58:42] [INFO] [experiment] Epoch 2/30 (32.41s): train_loss=0.6810, train_top1=0.2039, train_top3=0.8400, val_loss=0.5566 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 04:14:34] [INFO] [experiment] Epoch 3/30 (952.71s): train_loss=0.6338, train_top1=0.2706, train_top3=0.8796, val_loss=0.5566 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 04:15:06] [INFO] [experiment] Epoch 4/30 (31.79s): train_loss=0.5851, train_top1=0.2576, train_top3=0.9008, val_loss=0.5566 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 04:31:50] [INFO] [experiment] Epoch 5/30 (1003.81s): train_loss=0.5323, train_top1=0.2576, train_top3=0.9642, val_loss=0.3980, val_kl=0.1768, val_top1=0.0455, val_top3=0.9610
[2026-01-20 04:32:14] [INFO] [experiment] Computing prediction distribution for epoch 5...
[2026-01-20 04:32:29] [INFO] [experiment] Epoch 5 prediction distribution: ['0.1572', '0.1219', '0.1465', '0.1372', '0.1238', '0.0665', '0.1503', '0.0965']
[2026-01-20 04:32:29] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/prediction_distributions.json
[2026-01-20 04:32:29] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 04:32:29] [INFO] [experiment] New best validation loss: 0.3980 (patience counter reset to 0)
[2026-01-20 04:48:51] [INFO] [experiment] Epoch 6/30 (982.27s): train_loss=0.4899, train_top1=0.2500, train_top3=0.9713, val_loss=0.3980 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 04:49:20] [INFO] [experiment] Epoch 7/30 (28.71s): train_loss=0.4610, train_top1=0.2473, train_top3=0.9778, val_loss=0.3980 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 05:05:16] [INFO] [experiment] Epoch 8/30 (956.04s): train_loss=0.4454, train_top1=0.2272, train_top3=0.9837, val_loss=0.3980 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 05:05:46] [INFO] [experiment] Epoch 9/30 (29.89s): train_loss=0.4335, train_top1=0.2392, train_top3=0.9892, val_loss=0.3980 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 05:23:12] [INFO] [experiment] Epoch 10/30 (1045.59s): train_loss=0.4298, train_top1=0.2386, train_top3=0.9881, val_loss=0.4210, val_kl=0.1740, val_top1=0.4156, val_top3=0.9610
[2026-01-20 05:39:43] [INFO] [experiment] Computing prediction distribution for epoch 10...
[2026-01-20 05:39:58] [INFO] [experiment] Epoch 10 prediction distribution: ['0.1756', '0.1130', '0.1307', '0.1336', '0.0930', '0.0804', '0.1894', '0.0843']
[2026-01-20 05:39:58] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/prediction_distributions.json
[2026-01-20 05:39:58] [INFO] [experiment] No improvement (val_loss: 0.4210 >= best: 0.3980 - 0.0005). Patience counter: 1/5
[2026-01-20 05:39:58] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_10.pt
[2026-01-20 05:56:08] [INFO] [experiment] Epoch 11/30 (969.99s): train_loss=0.4274, train_top1=0.2310, train_top3=0.9875, val_loss=0.4210 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 05:56:37] [INFO] [experiment] Epoch 12/30 (29.10s): train_loss=0.4252, train_top1=0.2348, train_top3=0.9946, val_loss=0.4210 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:04:37] [INFO] [experiment] Epoch 13/30 (480.35s): train_loss=0.4235, train_top1=0.2419, train_top3=0.9973, val_loss=0.4210 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:05:06] [INFO] [experiment] Epoch 14/30 (28.57s): train_loss=0.4239, train_top1=0.2283, train_top3=0.9973, val_loss=0.4210 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:21:06] [INFO] [experiment] Epoch 15/30 (959.95s): train_loss=0.4225, train_top1=0.2516, train_top3=0.9973, val_loss=0.4182, val_kl=0.1727, val_top1=0.4156, val_top3=0.9610
[2026-01-20 06:21:29] [INFO] [experiment] Computing prediction distribution for epoch 15...
[2026-01-20 06:37:09] [INFO] [experiment] Epoch 15 prediction distribution: ['0.1748', '0.1073', '0.1331', '0.1374', '0.0848', '0.0876', '0.1892', '0.0857']
[2026-01-20 06:37:09] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/prediction_distributions.json
[2026-01-20 06:37:09] [INFO] [experiment] No improvement (val_loss: 0.4182 >= best: 0.3980 - 0.0005). Patience counter: 2/5
[2026-01-20 06:37:38] [INFO] [experiment] Epoch 16/30 (28.78s): train_loss=0.4229, train_top1=0.2478, train_top3=0.9978, val_loss=0.4182 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:38:07] [INFO] [experiment] Epoch 17/30 (29.13s): train_loss=0.4223, train_top1=0.2424, train_top3=0.9978, val_loss=0.4182 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:38:36] [INFO] [experiment] Epoch 18/30 (28.64s): train_loss=0.4224, train_top1=0.2424, train_top3=0.9978, val_loss=0.4182 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:39:03] [INFO] [experiment] Epoch 19/30 (27.41s): train_loss=0.4226, train_top1=0.2408, train_top3=0.9973, val_loss=0.4182 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:39:45] [INFO] [experiment] Epoch 20/30 (41.91s): train_loss=0.4220, train_top1=0.2370, train_top3=0.9978, val_loss=0.4144, val_kl=0.1717, val_top1=0.4156, val_top3=0.9610
[2026-01-20 06:40:07] [INFO] [experiment] Computing prediction distribution for epoch 20...
[2026-01-20 06:40:22] [INFO] [experiment] Epoch 20 prediction distribution: ['0.1738', '0.1037', '0.1351', '0.1377', '0.0832', '0.0910', '0.1876', '0.0877']
[2026-01-20 06:40:22] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/prediction_distributions.json
[2026-01-20 06:40:22] [INFO] [experiment] No improvement (val_loss: 0.4144 >= best: 0.3980 - 0.0005). Patience counter: 3/5
[2026-01-20 06:40:22] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_20.pt
[2026-01-20 06:40:51] [INFO] [experiment] Epoch 21/30 (28.93s): train_loss=0.4218, train_top1=0.2538, train_top3=0.9973, val_loss=0.4144 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:41:18] [INFO] [experiment] Epoch 22/30 (27.01s): train_loss=0.4215, train_top1=0.2430, train_top3=0.9973, val_loss=0.4144 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:41:44] [INFO] [experiment] Epoch 23/30 (26.81s): train_loss=0.4212, train_top1=0.2457, train_top3=0.9984, val_loss=0.4144 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:42:13] [INFO] [experiment] Epoch 24/30 (28.87s): train_loss=0.4217, train_top1=0.2701, train_top3=0.9973, val_loss=0.4144 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:42:58] [INFO] [experiment] Epoch 25/30 (44.60s): train_loss=0.4212, train_top1=0.2430, train_top3=0.9978, val_loss=0.4160, val_kl=0.1727, val_top1=0.4156, val_top3=0.9610
[2026-01-20 06:43:20] [INFO] [experiment] Computing prediction distribution for epoch 25...
[2026-01-20 06:43:35] [INFO] [experiment] Epoch 25 prediction distribution: ['0.1744', '0.1009', '0.1361', '0.1387', '0.0826', '0.0931', '0.1861', '0.0882']
[2026-01-20 06:43:35] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/prediction_distributions.json
[2026-01-20 06:43:35] [INFO] [experiment] No improvement (val_loss: 0.4160 >= best: 0.3980 - 0.0005). Patience counter: 4/5
[2026-01-20 06:44:02] [INFO] [experiment] Epoch 26/30 (27.59s): train_loss=0.4210, train_top1=0.2538, train_top3=0.9973, val_loss=0.4160 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:44:30] [INFO] [experiment] Epoch 27/30 (27.64s): train_loss=0.4208, train_top1=0.2511, train_top3=0.9973, val_loss=0.4160 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:44:57] [INFO] [experiment] Epoch 28/30 (26.92s): train_loss=0.4208, train_top1=0.2570, train_top3=0.9973, val_loss=0.4160 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:45:25] [INFO] [experiment] Epoch 29/30 (27.63s): train_loss=0.4209, train_top1=0.2614, train_top3=0.9973, val_loss=0.4160 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 06:46:07] [INFO] [experiment] Epoch 30/30 (42.44s): train_loss=0.4211, train_top1=0.2500, train_top3=0.9984, val_loss=0.4113, val_kl=0.1706, val_top1=0.4156, val_top3=0.9610
[2026-01-20 06:46:29] [INFO] [experiment] Computing prediction distribution for epoch 30...
[2026-01-20 06:46:44] [INFO] [experiment] Epoch 30 prediction distribution: ['0.1720', '0.1006', '0.1387', '0.1385', '0.0822', '0.0932', '0.1863', '0.0885']
[2026-01-20 06:46:44] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/prediction_distributions.json
[2026-01-20 06:46:44] [INFO] [experiment] No improvement (val_loss: 0.4113 >= best: 0.3980 - 0.0005). Patience counter: 5/5
[2026-01-20 06:46:44] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_30.pt
[2026-01-20 06:46:44] [INFO] [experiment] Early stopping triggered after 30 epochs (patience: 5 validation epochs without improvement)
[2026-01-20 06:46:44] [INFO] [experiment] Evaluating on test set and saving predictions...
[2026-01-20 06:47:07] [INFO] [experiment] Test metrics: loss=0.7758, kl=0.3463, top1=0.3484, top3=0.9791
[2026-01-20 06:47:33] [INFO] [src.evaluation.save_predictions] Saved 1484 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/test_predictions.csv
[2026-01-20 06:47:33] [INFO] [src.evaluation.save_predictions] Saved evaluation results to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/test_evaluation_results.json
[2026-01-20 06:47:33] [INFO] [experiment] Saved test predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/test_predictions.csv
[2026-01-20 06:47:50] [INFO] [src.evaluation.save_predictions] Saved 308 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/val_predictions.csv
[2026-01-20 06:47:50] [INFO] [experiment] Saved validation predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/val_predictions.csv
[2026-01-20 06:47:50] [INFO] [experiment] Generating training plots...
[2026-01-20 06:47:50] [INFO] [src.evaluation.plotting] Saved training curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/plots/training_training_curves.png
[2026-01-20 06:47:50] [INFO] [src.evaluation.plotting] Saved loss comparison to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/plots/training_loss_comparison.png
[2026-01-20 06:47:51] [INFO] [src.evaluation.plotting] Saved accuracy curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/plots/training_accuracy_curves.png
[2026-01-20 06:47:51] [INFO] [src.evaluation.plotting] Saved all training summary plots to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/plots
[2026-01-20 06:47:51] [INFO] [src.evaluation.plotting] Saved neighbor distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/plots/neighbor_distribution.png
[2026-01-20 06:47:51] [INFO] [src.evaluation.plotting] Saved target probability distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/plots/target_probability_distribution.png
[2026-01-20 06:47:51] [INFO] [experiment] Training complete
[2026-01-20 06:47:51] [INFO] [experiment] Best validation loss: 0.3980
[2026-01-20 06:47:51] [INFO] [experiment] Results saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run
[2026-01-20 06:47:51] [INFO] [experiment] Plots saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/reduced_temperature/run/plots
