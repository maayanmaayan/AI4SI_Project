[2026-01-20 01:20:25] [INFO] [experiment] Starting training
[2026-01-20 01:20:25] [INFO] [experiment] Using device: mps
[2026-01-20 01:20:25] [INFO] [experiment] Loading features from data/processed/features/compliant
[2026-01-20 01:20:25] [INFO] [src.training.dataset] Found 7 target_points.parquet files in data/processed/features/compliant
[2026-01-20 01:20:26] [INFO] [src.training.dataset] Combined 3636 total rows from 7 files, 7 unique neighborhoods
[2026-01-20 01:20:26] [INFO] [src.training.dataset] Created splits: Train=1844 rows (4 neighborhoods), Val=308 rows (1 neighborhoods), Test=1484 rows (2 neighborhoods)
[2026-01-20 01:20:26] [INFO] [experiment] Calculating class weights from training dataset...
[2026-01-20 01:20:26] [INFO] [experiment] Class counts: [487, 60, 478, 208, 27, 64, 479, 41]
[2026-01-20 01:20:26] [INFO] [experiment] Class weights (before damping): [3.786447525024414, 30.733333587646484, 3.857740640640259, 8.865385055541992, 68.29629516601562, 28.8125, 3.849686861038208, 44.975608825683594]
[2026-01-20 01:20:26] [INFO] [experiment] Class weights (after sqrt damping and capping at 3.0): [1.945879578590393, 3.0, 1.9641132354736328, 2.9774796962738037, 3.0, 3.0, 1.962061882019043, 3.0]
[2026-01-20 01:20:26] [INFO] [experiment] Data augmentation enabled: feature_noise (p=0.8, std=0.01), neighbor_subsampling (p=0.5, ratio=0.8), edge_noise (p=0.3, std=0.02)
[2026-01-20 01:20:26] [INFO] [experiment] Computing true class distribution from training dataset...
[2026-01-20 01:20:28] [INFO] [experiment] True distribution: ['0.1571', '0.0913', '0.1712', '0.1383', '0.0718', '0.0792', '0.1926', '0.0985']
[2026-01-20 01:20:28] [INFO] [experiment] Created datasets: Train=1844, Val=308, Test=1484
[2026-01-20 01:20:28] [INFO] [src.training.model] Created SpatialGraphTransformer: 47,752 parameters
[2026-01-20 01:20:28] [INFO] [experiment] Loss function: label_smoothing=0.0, class_weights capped at 3.0, entropy_weight=0.5, min_entropy=0.5, entropy_penalty_type=linear, maxsup_weight=0.1, maxsup_threshold=0.0
[2026-01-20 01:20:28] [INFO] [experiment] Optimizer: using separate weight decay - base=0.001, final_layer=0.011
[2026-01-20 01:20:28] [INFO] [experiment] Initialized prediction distribution file: /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/prediction_distributions.json
[2026-01-20 01:20:28] [INFO] [experiment] Starting training loop
[2026-01-20 01:21:15] [INFO] [experiment] Epoch 1/30 (46.75s): train_loss=0.5616, train_top1=0.0152, train_top3=0.8308, val_loss=0.4207, val_kl=0.1891, val_top1=0.0260, val_top3=0.8409
[2026-01-20 01:21:38] [INFO] [experiment] Computing prediction distribution for epoch 1...
[2026-01-20 01:21:53] [INFO] [experiment] Epoch 1 prediction distribution: ['0.1207', '0.1314', '0.1359', '0.1216', '0.1380', '0.1067', '0.1141', '0.1317']
[2026-01-20 01:21:53] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/prediction_distributions.json
[2026-01-20 01:21:53] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:21:53] [INFO] [experiment] New best validation loss: 0.4207 (patience counter reset to 0)
[2026-01-20 01:22:23] [INFO] [experiment] Epoch 2/30 (29.75s): train_loss=0.5488, train_top1=0.2240, train_top3=0.8427, val_loss=0.4207 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:22:52] [INFO] [experiment] Epoch 3/30 (29.44s): train_loss=0.5382, train_top1=0.2706, train_top3=0.8921, val_loss=0.4207 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:23:23] [INFO] [experiment] Epoch 4/30 (30.65s): train_loss=0.5274, train_top1=0.2576, train_top3=0.8943, val_loss=0.4207 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:24:08] [INFO] [experiment] Epoch 5/30 (45.39s): train_loss=0.5152, train_top1=0.2576, train_top3=0.9626, val_loss=0.3874, val_kl=0.1745, val_top1=0.0455, val_top3=0.9610
[2026-01-20 01:24:32] [INFO] [experiment] Computing prediction distribution for epoch 5...
[2026-01-20 01:24:47] [INFO] [experiment] Epoch 5 prediction distribution: ['0.1342', '0.1243', '0.1339', '0.1294', '0.1237', '0.1047', '0.1333', '0.1166']
[2026-01-20 01:24:47] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/prediction_distributions.json
[2026-01-20 01:24:47] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:24:47] [INFO] [experiment] New best validation loss: 0.3874 (patience counter reset to 0)
[2026-01-20 01:25:15] [INFO] [experiment] Epoch 6/30 (28.74s): train_loss=0.5049, train_top1=0.2554, train_top3=0.9767, val_loss=0.3874 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:25:43] [INFO] [experiment] Epoch 7/30 (27.95s): train_loss=0.4970, train_top1=0.2636, train_top3=0.9778, val_loss=0.3874 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:26:12] [INFO] [experiment] Epoch 8/30 (28.86s): train_loss=0.4920, train_top1=0.2467, train_top3=0.9859, val_loss=0.3874 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:26:41] [INFO] [experiment] Epoch 9/30 (29.38s): train_loss=0.4881, train_top1=0.2424, train_top3=0.9892, val_loss=0.3874 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:27:25] [INFO] [experiment] Epoch 10/30 (43.79s): train_loss=0.4869, train_top1=0.2381, train_top3=0.9881, val_loss=0.3911, val_kl=0.1723, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:27:47] [INFO] [experiment] Computing prediction distribution for epoch 10...
[2026-01-20 01:28:02] [INFO] [experiment] Epoch 10 prediction distribution: ['0.1393', '0.1218', '0.1292', '0.1288', '0.1153', '0.1112', '0.1415', '0.1129']
[2026-01-20 01:28:02] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/prediction_distributions.json
[2026-01-20 01:28:02] [INFO] [experiment] No improvement (val_loss: 0.3911 >= best: 0.3874 - 0.0005). Patience counter: 1/5
[2026-01-20 01:28:02] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_10.pt
[2026-01-20 01:28:30] [INFO] [experiment] Epoch 11/30 (28.00s): train_loss=0.4858, train_top1=0.2332, train_top3=0.9875, val_loss=0.3911 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:28:58] [INFO] [experiment] Epoch 12/30 (27.80s): train_loss=0.4849, train_top1=0.2278, train_top3=0.9875, val_loss=0.3911 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:29:25] [INFO] [experiment] Epoch 13/30 (27.02s): train_loss=0.4841, train_top1=0.2522, train_top3=0.9870, val_loss=0.3911 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:29:53] [INFO] [experiment] Epoch 14/30 (28.16s): train_loss=0.4841, train_top1=0.2289, train_top3=0.9973, val_loss=0.3911 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:30:36] [INFO] [experiment] Epoch 15/30 (43.59s): train_loss=0.4836, train_top1=0.2451, train_top3=0.9973, val_loss=0.3902, val_kl=0.1716, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:30:58] [INFO] [experiment] Computing prediction distribution for epoch 15...
[2026-01-20 01:31:13] [INFO] [experiment] Epoch 15 prediction distribution: ['0.1390', '0.1202', '0.1300', '0.1298', '0.1124', '0.1135', '0.1417', '0.1135']
[2026-01-20 01:31:13] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/prediction_distributions.json
[2026-01-20 01:31:13] [INFO] [experiment] No improvement (val_loss: 0.3902 >= best: 0.3874 - 0.0005). Patience counter: 2/5
[2026-01-20 01:31:41] [INFO] [experiment] Epoch 16/30 (27.72s): train_loss=0.4837, train_top1=0.2467, train_top3=0.9978, val_loss=0.3902 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:32:08] [INFO] [experiment] Epoch 17/30 (27.45s): train_loss=0.4836, train_top1=0.2478, train_top3=0.9978, val_loss=0.3902 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:32:36] [INFO] [experiment] Epoch 18/30 (28.19s): train_loss=0.4836, train_top1=0.2533, train_top3=0.9978, val_loss=0.3902 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:33:04] [INFO] [experiment] Epoch 19/30 (27.95s): train_loss=0.4836, train_top1=0.2348, train_top3=0.9973, val_loss=0.3902 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:33:46] [INFO] [experiment] Epoch 20/30 (41.86s): train_loss=0.4835, train_top1=0.2348, train_top3=0.9978, val_loss=0.3897, val_kl=0.1713, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:34:08] [INFO] [experiment] Computing prediction distribution for epoch 20...
[2026-01-20 01:34:23] [INFO] [experiment] Epoch 20 prediction distribution: ['0.1387', '0.1190', '0.1306', '0.1302', '0.1117', '0.1142', '0.1415', '0.1141']
[2026-01-20 01:34:23] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/prediction_distributions.json
[2026-01-20 01:34:23] [INFO] [experiment] No improvement (val_loss: 0.3897 >= best: 0.3874 - 0.0005). Patience counter: 3/5
[2026-01-20 01:34:23] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_20.pt
[2026-01-20 01:34:51] [INFO] [experiment] Epoch 21/30 (28.29s): train_loss=0.4834, train_top1=0.2505, train_top3=0.9973, val_loss=0.3897 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:35:17] [INFO] [experiment] Epoch 22/30 (26.57s): train_loss=0.4834, train_top1=0.2435, train_top3=0.9973, val_loss=0.3897 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:35:44] [INFO] [experiment] Epoch 23/30 (26.13s): train_loss=0.4832, train_top1=0.2435, train_top3=0.9984, val_loss=0.3897 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:36:12] [INFO] [experiment] Epoch 24/30 (28.30s): train_loss=0.4834, train_top1=0.2690, train_top3=0.9973, val_loss=0.3897 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:36:55] [INFO] [experiment] Epoch 25/30 (42.79s): train_loss=0.4833, train_top1=0.2484, train_top3=0.9978, val_loss=0.3903, val_kl=0.1717, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:37:17] [INFO] [experiment] Computing prediction distribution for epoch 25...
[2026-01-20 01:37:31] [INFO] [experiment] Epoch 25 prediction distribution: ['0.1388', '0.1179', '0.1308', '0.1307', '0.1116', '0.1148', '0.1412', '0.1142']
[2026-01-20 01:37:31] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/prediction_distributions.json
[2026-01-20 01:37:31] [INFO] [experiment] No improvement (val_loss: 0.3903 >= best: 0.3874 - 0.0005). Patience counter: 4/5
[2026-01-20 01:37:58] [INFO] [experiment] Epoch 26/30 (26.94s): train_loss=0.4832, train_top1=0.2527, train_top3=0.9973, val_loss=0.3903 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:38:25] [INFO] [experiment] Epoch 27/30 (27.16s): train_loss=0.4831, train_top1=0.2430, train_top3=0.9973, val_loss=0.3903 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:38:52] [INFO] [experiment] Epoch 28/30 (26.98s): train_loss=0.4832, train_top1=0.2533, train_top3=0.9973, val_loss=0.3903 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:39:19] [INFO] [experiment] Epoch 29/30 (27.02s): train_loss=0.4832, train_top1=0.2538, train_top3=0.9973, val_loss=0.3903 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:40:01] [INFO] [experiment] Epoch 30/30 (42.18s): train_loss=0.4832, train_top1=0.2522, train_top3=0.9984, val_loss=0.3892, val_kl=0.1711, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:40:24] [INFO] [experiment] Computing prediction distribution for epoch 30...
[2026-01-20 01:40:38] [INFO] [experiment] Epoch 30 prediction distribution: ['0.1382', '0.1178', '0.1314', '0.1308', '0.1115', '0.1147', '0.1413', '0.1143']
[2026-01-20 01:40:38] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/prediction_distributions.json
[2026-01-20 01:40:38] [INFO] [experiment] No improvement (val_loss: 0.3892 >= best: 0.3874 - 0.0005). Patience counter: 5/5
[2026-01-20 01:40:38] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_30.pt
[2026-01-20 01:40:38] [INFO] [experiment] Early stopping triggered after 30 epochs (patience: 5 validation epochs without improvement)
[2026-01-20 01:40:38] [INFO] [experiment] Evaluating on test set and saving predictions...
[2026-01-20 01:41:00] [INFO] [experiment] Test metrics: loss=0.8705, kl=0.3977, top1=0.3484, top3=0.9791
[2026-01-20 01:41:24] [INFO] [src.evaluation.save_predictions] Saved 1484 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/test_predictions.csv
[2026-01-20 01:41:24] [INFO] [src.evaluation.save_predictions] Saved evaluation results to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/test_evaluation_results.json
[2026-01-20 01:41:24] [INFO] [experiment] Saved test predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/test_predictions.csv
[2026-01-20 01:41:40] [INFO] [src.evaluation.save_predictions] Saved 308 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/val_predictions.csv
[2026-01-20 01:41:40] [INFO] [experiment] Saved validation predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/val_predictions.csv
[2026-01-20 01:41:40] [INFO] [experiment] Generating training plots...
[2026-01-20 01:41:40] [INFO] [src.evaluation.plotting] Saved training curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/plots/training_training_curves.png
[2026-01-20 01:41:41] [INFO] [src.evaluation.plotting] Saved loss comparison to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/plots/training_loss_comparison.png
[2026-01-20 01:41:41] [INFO] [src.evaluation.plotting] Saved accuracy curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/plots/training_accuracy_curves.png
[2026-01-20 01:41:41] [INFO] [src.evaluation.plotting] Saved all training summary plots to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/plots
[2026-01-20 01:41:41] [INFO] [src.evaluation.plotting] Saved neighbor distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/plots/neighbor_distribution.png
[2026-01-20 01:41:42] [INFO] [src.evaluation.plotting] Saved target probability distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/plots/target_probability_distribution.png
[2026-01-20 01:41:42] [INFO] [experiment] Training complete
[2026-01-20 01:41:42] [INFO] [experiment] Best validation loss: 0.3874
[2026-01-20 01:41:42] [INFO] [experiment] Results saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run
[2026-01-20 01:41:42] [INFO] [experiment] Plots saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/baseline_reduced_entropy/run/plots
