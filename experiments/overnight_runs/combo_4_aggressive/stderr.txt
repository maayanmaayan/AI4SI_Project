[2026-01-20 07:09:34] [INFO] [experiment] Starting training
[2026-01-20 07:09:34] [INFO] [experiment] Using device: mps
[2026-01-20 07:09:34] [INFO] [experiment] Loading features from data/processed/features/compliant
[2026-01-20 07:09:34] [INFO] [src.training.dataset] Found 7 target_points.parquet files in data/processed/features/compliant
[2026-01-20 07:09:35] [INFO] [src.training.dataset] Combined 3636 total rows from 7 files, 7 unique neighborhoods
[2026-01-20 07:09:35] [INFO] [src.training.dataset] Created splits: Train=1844 rows (4 neighborhoods), Val=308 rows (1 neighborhoods), Test=1484 rows (2 neighborhoods)
[2026-01-20 07:09:35] [INFO] [experiment] Calculating class weights from training dataset...
[2026-01-20 07:09:35] [INFO] [experiment] Class counts: [487, 60, 478, 208, 27, 64, 479, 41]
[2026-01-20 07:09:35] [INFO] [experiment] Class weights (before damping): [3.786447525024414, 30.733333587646484, 3.857740640640259, 8.865385055541992, 68.29629516601562, 28.8125, 3.849686861038208, 44.975608825683594]
[2026-01-20 07:09:35] [INFO] [experiment] Class weights (after sqrt damping and capping at 3.0): [1.945879578590393, 3.0, 1.9641132354736328, 2.9774796962738037, 3.0, 3.0, 1.962061882019043, 3.0]
[2026-01-20 07:09:35] [INFO] [experiment] Data augmentation enabled: feature_noise (p=0.8, std=0.01), neighbor_subsampling (p=0.5, ratio=0.8), edge_noise (p=0.3, std=0.02)
[2026-01-20 07:09:35] [INFO] [experiment] Computing true class distribution from training dataset...
[2026-01-20 07:09:37] [INFO] [experiment] True distribution: ['0.1571', '0.0913', '0.1712', '0.1383', '0.0718', '0.0792', '0.1926', '0.0985']
[2026-01-20 07:09:37] [INFO] [experiment] Created datasets: Train=1844, Val=308, Test=1484
[2026-01-20 07:09:37] [INFO] [src.training.model] Created SpatialGraphTransformer: 47,752 parameters
[2026-01-20 07:09:37] [INFO] [experiment] Loss function: label_smoothing=0.0, class_weights capped at 3.0, entropy_weight=0.1, min_entropy=0.3, entropy_penalty_type=linear, maxsup_weight=0.0, maxsup_threshold=0.0
[2026-01-20 07:09:37] [INFO] [experiment] Optimizer: using separate weight decay - base=0.001, final_layer=0.011
[2026-01-20 07:09:37] [INFO] [experiment] Initialized prediction distribution file: /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/prediction_distributions.json
[2026-01-20 07:09:37] [INFO] [experiment] Starting training loop
[2026-01-20 07:10:24] [INFO] [experiment] Epoch 1/30 (46.59s): train_loss=1.0123, train_top1=0.0819, train_top3=0.8308, val_loss=0.6604, val_kl=0.2976, val_top1=0.2305, val_top3=0.8994
[2026-01-20 07:10:47] [INFO] [experiment] Computing prediction distribution for epoch 1...
[2026-01-20 07:11:01] [INFO] [experiment] Epoch 1 prediction distribution: ['0.0829', '0.1462', '0.2261', '0.1147', '0.1988', '0.0296', '0.0749', '0.1269']
[2026-01-20 07:11:01] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/prediction_distributions.json
[2026-01-20 07:11:01] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 07:11:01] [INFO] [experiment] New best validation loss: 0.6604 (patience counter reset to 0)
[2026-01-20 07:11:31] [INFO] [experiment] Epoch 2/30 (29.77s): train_loss=0.7840, train_top1=0.2679, train_top3=0.8926, val_loss=0.6604 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:12:01] [INFO] [experiment] Epoch 3/30 (29.40s): train_loss=0.5687, train_top1=0.2760, train_top3=0.9761, val_loss=0.6604 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:12:31] [INFO] [experiment] Epoch 4/30 (30.56s): train_loss=0.4510, train_top1=0.2522, train_top3=0.9864, val_loss=0.6604 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:13:17] [INFO] [experiment] Epoch 5/30 (45.84s): train_loss=0.4201, train_top1=0.2603, train_top3=0.9908, val_loss=0.5393, val_kl=0.2327, val_top1=0.4156, val_top3=0.9610
[2026-01-20 07:13:40] [INFO] [experiment] Computing prediction distribution for epoch 5...
[2026-01-20 07:13:55] [INFO] [experiment] Epoch 5 prediction distribution: ['0.2145', '0.0922', '0.1208', '0.1242', '0.0660', '0.0592', '0.2658', '0.0573']
[2026-01-20 07:13:55] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/prediction_distributions.json
[2026-01-20 07:13:55] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 07:13:55] [INFO] [experiment] New best validation loss: 0.5393 (patience counter reset to 0)
[2026-01-20 07:14:25] [INFO] [experiment] Epoch 6/30 (29.32s): train_loss=0.4134, train_top1=0.2636, train_top3=0.9973, val_loss=0.5393 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:14:52] [INFO] [experiment] Epoch 7/30 (27.82s): train_loss=0.4111, train_top1=0.2630, train_top3=0.9984, val_loss=0.5393 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:15:28] [INFO] [experiment] Epoch 8/30 (35.92s): train_loss=0.4105, train_top1=0.2625, train_top3=0.9978, val_loss=0.5393 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:16:01] [INFO] [experiment] Epoch 9/30 (33.04s): train_loss=0.4079, train_top1=0.2603, train_top3=0.9978, val_loss=0.5393 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:16:48] [INFO] [experiment] Epoch 10/30 (46.53s): train_loss=0.4087, train_top1=0.2630, train_top3=0.9973, val_loss=0.4842, val_kl=0.2082, val_top1=0.4156, val_top3=0.9610
[2026-01-20 07:17:11] [INFO] [experiment] Computing prediction distribution for epoch 10...
[2026-01-20 07:17:26] [INFO] [experiment] Epoch 10 prediction distribution: ['0.1874', '0.0886', '0.1288', '0.1217', '0.0622', '0.0719', '0.2771', '0.0624']
[2026-01-20 07:17:26] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/prediction_distributions.json
[2026-01-20 07:17:26] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 07:17:26] [INFO] [experiment] New best validation loss: 0.4842 (patience counter reset to 0)
[2026-01-20 07:17:26] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_10.pt
[2026-01-20 07:17:55] [INFO] [experiment] Epoch 11/30 (29.50s): train_loss=0.4089, train_top1=0.2608, train_top3=0.9973, val_loss=0.4842 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:18:24] [INFO] [experiment] Epoch 12/30 (28.68s): train_loss=0.4083, train_top1=0.2630, train_top3=0.9973, val_loss=0.4842 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:18:52] [INFO] [experiment] Epoch 13/30 (28.06s): train_loss=0.4075, train_top1=0.2614, train_top3=0.9973, val_loss=0.4842 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:19:21] [INFO] [experiment] Epoch 14/30 (29.34s): train_loss=0.4080, train_top1=0.2636, train_top3=0.9973, val_loss=0.4842 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:20:05] [INFO] [experiment] Epoch 15/30 (43.79s): train_loss=0.4066, train_top1=0.2625, train_top3=0.9973, val_loss=0.4791, val_kl=0.2064, val_top1=0.4156, val_top3=0.9610
[2026-01-20 07:20:27] [INFO] [experiment] Computing prediction distribution for epoch 15...
[2026-01-20 07:20:42] [INFO] [experiment] Epoch 15 prediction distribution: ['0.1922', '0.0858', '0.1283', '0.1261', '0.0614', '0.0771', '0.2634', '0.0656']
[2026-01-20 07:20:42] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/prediction_distributions.json
[2026-01-20 07:20:42] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 07:20:42] [INFO] [experiment] New best validation loss: 0.4791 (patience counter reset to 0)
[2026-01-20 07:21:11] [INFO] [experiment] Epoch 16/30 (28.86s): train_loss=0.4070, train_top1=0.2641, train_top3=0.9962, val_loss=0.4791 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:21:39] [INFO] [experiment] Epoch 17/30 (28.46s): train_loss=0.4066, train_top1=0.2630, train_top3=0.9962, val_loss=0.4791 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:22:09] [INFO] [experiment] Epoch 18/30 (29.63s): train_loss=0.4068, train_top1=0.2625, train_top3=0.9967, val_loss=0.4791 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:22:37] [INFO] [experiment] Epoch 19/30 (27.94s): train_loss=0.4064, train_top1=0.2592, train_top3=0.9951, val_loss=0.4791 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:23:21] [INFO] [experiment] Epoch 20/30 (44.29s): train_loss=0.4061, train_top1=0.2592, train_top3=0.9962, val_loss=0.4660, val_kl=0.2010, val_top1=0.4156, val_top3=0.9610
[2026-01-20 07:23:44] [INFO] [experiment] Computing prediction distribution for epoch 20...
[2026-01-20 07:23:59] [INFO] [experiment] Epoch 20 prediction distribution: ['0.1921', '0.0854', '0.1308', '0.1265', '0.0631', '0.0782', '0.2551', '0.0689']
[2026-01-20 07:23:59] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/prediction_distributions.json
[2026-01-20 07:23:59] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 07:23:59] [INFO] [experiment] New best validation loss: 0.4660 (patience counter reset to 0)
[2026-01-20 07:23:59] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_20.pt
[2026-01-20 07:24:30] [INFO] [experiment] Epoch 21/30 (30.84s): train_loss=0.4056, train_top1=0.2598, train_top3=0.9962, val_loss=0.4660 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:24:59] [INFO] [experiment] Epoch 22/30 (28.96s): train_loss=0.4049, train_top1=0.2619, train_top3=0.9967, val_loss=0.4660 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:25:27] [INFO] [experiment] Epoch 23/30 (28.23s): train_loss=0.4042, train_top1=0.2625, train_top3=0.9978, val_loss=0.4660 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:25:58] [INFO] [experiment] Epoch 24/30 (30.70s): train_loss=0.4050, train_top1=0.2663, train_top3=0.9962, val_loss=0.4660 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:26:42] [INFO] [experiment] Epoch 25/30 (44.52s): train_loss=0.4040, train_top1=0.2619, train_top3=0.9967, val_loss=0.4706, val_kl=0.2029, val_top1=0.4156, val_top3=0.9610
[2026-01-20 07:27:06] [INFO] [experiment] Computing prediction distribution for epoch 25...
[2026-01-20 07:27:20] [INFO] [experiment] Epoch 25 prediction distribution: ['0.1946', '0.0825', '0.1326', '0.1294', '0.0630', '0.0781', '0.2508', '0.0690']
[2026-01-20 07:27:20] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/prediction_distributions.json
[2026-01-20 07:27:20] [INFO] [experiment] No improvement (val_loss: 0.4706 >= best: 0.4660 - 0.0005). Patience counter: 1/5
[2026-01-20 07:27:49] [INFO] [experiment] Epoch 26/30 (29.01s): train_loss=0.4037, train_top1=0.2614, train_top3=0.9967, val_loss=0.4706 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:28:18] [INFO] [experiment] Epoch 27/30 (28.29s): train_loss=0.4032, train_top1=0.2625, train_top3=0.9962, val_loss=0.4706 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:28:45] [INFO] [experiment] Epoch 28/30 (27.14s): train_loss=0.4034, train_top1=0.2641, train_top3=0.9957, val_loss=0.4706 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:29:12] [INFO] [experiment] Epoch 29/30 (27.10s): train_loss=0.4030, train_top1=0.2619, train_top3=0.9946, val_loss=0.4706 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 07:29:54] [INFO] [experiment] Epoch 30/30 (42.60s): train_loss=0.4030, train_top1=0.2625, train_top3=0.9973, val_loss=0.4496, val_kl=0.1937, val_top1=0.4156, val_top3=0.9610
[2026-01-20 07:30:17] [INFO] [experiment] Computing prediction distribution for epoch 30...
[2026-01-20 07:30:31] [INFO] [experiment] Epoch 30 prediction distribution: ['0.1856', '0.0857', '0.1396', '0.1286', '0.0629', '0.0771', '0.2508', '0.0697']
[2026-01-20 07:30:31] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/prediction_distributions.json
[2026-01-20 07:30:31] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 07:30:31] [INFO] [experiment] New best validation loss: 0.4496 (patience counter reset to 0)
[2026-01-20 07:30:31] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_30.pt
[2026-01-20 07:30:31] [INFO] [experiment] Evaluating on test set and saving predictions...
[2026-01-20 07:30:53] [INFO] [experiment] Test metrics: loss=0.7299, kl=0.3260, top1=0.3484, top3=0.9791
[2026-01-20 07:31:18] [INFO] [src.evaluation.save_predictions] Saved 1484 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/test_predictions.csv
[2026-01-20 07:31:18] [INFO] [src.evaluation.save_predictions] Saved evaluation results to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/test_evaluation_results.json
[2026-01-20 07:31:18] [INFO] [experiment] Saved test predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/test_predictions.csv
[2026-01-20 07:31:33] [INFO] [src.evaluation.save_predictions] Saved 308 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/val_predictions.csv
[2026-01-20 07:31:33] [INFO] [experiment] Saved validation predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/val_predictions.csv
[2026-01-20 07:31:33] [INFO] [experiment] Generating training plots...
[2026-01-20 07:31:34] [INFO] [src.evaluation.plotting] Saved training curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/plots/training_training_curves.png
[2026-01-20 07:31:34] [INFO] [src.evaluation.plotting] Saved loss comparison to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/plots/training_loss_comparison.png
[2026-01-20 07:31:34] [INFO] [src.evaluation.plotting] Saved accuracy curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/plots/training_accuracy_curves.png
[2026-01-20 07:31:34] [INFO] [src.evaluation.plotting] Saved all training summary plots to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/plots
[2026-01-20 07:31:34] [INFO] [src.evaluation.plotting] Saved neighbor distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/plots/neighbor_distribution.png
[2026-01-20 07:31:35] [INFO] [src.evaluation.plotting] Saved target probability distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/plots/target_probability_distribution.png
[2026-01-20 07:31:35] [INFO] [experiment] Training complete
[2026-01-20 07:31:35] [INFO] [experiment] Best validation loss: 0.4496
[2026-01-20 07:31:35] [INFO] [experiment] Results saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run
[2026-01-20 07:31:35] [INFO] [experiment] Plots saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_4_aggressive/run/plots
