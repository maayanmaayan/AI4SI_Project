[2026-01-20 01:41:53] [INFO] [experiment] Starting training
[2026-01-20 01:41:53] [INFO] [experiment] Using device: mps
[2026-01-20 01:41:53] [INFO] [experiment] Loading features from data/processed/features/compliant
[2026-01-20 01:41:53] [INFO] [src.training.dataset] Found 7 target_points.parquet files in data/processed/features/compliant
[2026-01-20 01:41:54] [INFO] [src.training.dataset] Combined 3636 total rows from 7 files, 7 unique neighborhoods
[2026-01-20 01:41:54] [INFO] [src.training.dataset] Created splits: Train=1844 rows (4 neighborhoods), Val=308 rows (1 neighborhoods), Test=1484 rows (2 neighborhoods)
[2026-01-20 01:41:54] [INFO] [experiment] Calculating class weights from training dataset...
[2026-01-20 01:41:54] [INFO] [experiment] Class counts: [487, 60, 478, 208, 27, 64, 479, 41]
[2026-01-20 01:41:54] [INFO] [experiment] Class weights (before damping): [3.786447525024414, 30.733333587646484, 3.857740640640259, 8.865385055541992, 68.29629516601562, 28.8125, 3.849686861038208, 44.975608825683594]
[2026-01-20 01:41:54] [INFO] [experiment] Class weights (after sqrt damping and capping at 3.0): [1.945879578590393, 3.0, 1.9641132354736328, 2.9774796962738037, 3.0, 3.0, 1.962061882019043, 3.0]
[2026-01-20 01:41:54] [INFO] [experiment] Data augmentation enabled: feature_noise (p=0.8, std=0.01), neighbor_subsampling (p=0.5, ratio=0.8), edge_noise (p=0.3, std=0.02)
[2026-01-20 01:41:54] [INFO] [experiment] Computing true class distribution from training dataset...
[2026-01-20 01:41:56] [INFO] [experiment] True distribution: ['0.1571', '0.0913', '0.1712', '0.1383', '0.0718', '0.0792', '0.1926', '0.0985']
[2026-01-20 01:41:56] [INFO] [experiment] Created datasets: Train=1844, Val=308, Test=1484
[2026-01-20 01:41:56] [INFO] [src.training.model] Created SpatialGraphTransformer: 47,752 parameters
[2026-01-20 01:41:56] [INFO] [experiment] Loss function: label_smoothing=0.0, class_weights capped at 3.0, entropy_weight=2.0, min_entropy=1.0, entropy_penalty_type=linear, maxsup_weight=0.1, maxsup_threshold=0.0
[2026-01-20 01:41:56] [INFO] [experiment] Optimizer: using separate weight decay - base=0.001, final_layer=0.011
[2026-01-20 01:41:56] [INFO] [experiment] Initialized prediction distribution file: /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/prediction_distributions.json
[2026-01-20 01:41:56] [INFO] [experiment] Starting training loop
[2026-01-20 01:42:43] [INFO] [experiment] Epoch 1/30 (46.82s): train_loss=0.6084, train_top1=0.0157, train_top3=0.8308, val_loss=0.4518, val_kl=0.2000, val_top1=0.0260, val_top3=0.8409
[2026-01-20 01:43:06] [INFO] [experiment] Computing prediction distribution for epoch 1...
[2026-01-20 01:43:20] [INFO] [experiment] Epoch 1 prediction distribution: ['0.1155', '0.1370', '0.1466', '0.1177', '0.1513', '0.0909', '0.1033', '0.1378']
[2026-01-20 01:43:20] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/prediction_distributions.json
[2026-01-20 01:43:20] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:43:20] [INFO] [experiment] New best validation loss: 0.4518 (patience counter reset to 0)
[2026-01-20 01:43:50] [INFO] [experiment] Epoch 2/30 (30.14s): train_loss=0.5819, train_top1=0.2185, train_top3=0.8422, val_loss=0.4518 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:44:21] [INFO] [experiment] Epoch 3/30 (30.28s): train_loss=0.5602, train_top1=0.2706, train_top3=0.8921, val_loss=0.4518 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:44:51] [INFO] [experiment] Epoch 4/30 (30.25s): train_loss=0.5378, train_top1=0.2576, train_top3=0.8959, val_loss=0.4518 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:45:36] [INFO] [experiment] Epoch 5/30 (45.02s): train_loss=0.5131, train_top1=0.2576, train_top3=0.9642, val_loss=0.3827, val_kl=0.1709, val_top1=0.0455, val_top3=0.9610
[2026-01-20 01:45:58] [INFO] [experiment] Computing prediction distribution for epoch 5...
[2026-01-20 01:46:12] [INFO] [experiment] Epoch 5 prediction distribution: ['0.1424', '0.1233', '0.1404', '0.1329', '0.1230', '0.0888', '0.1402', '0.1090']
[2026-01-20 01:46:12] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/prediction_distributions.json
[2026-01-20 01:46:13] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:46:13] [INFO] [experiment] New best validation loss: 0.3827 (patience counter reset to 0)
[2026-01-20 01:46:42] [INFO] [experiment] Epoch 6/30 (29.57s): train_loss=0.4930, train_top1=0.2554, train_top3=0.9745, val_loss=0.3827 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:47:10] [INFO] [experiment] Epoch 7/30 (27.86s): train_loss=0.4779, train_top1=0.2576, train_top3=0.9778, val_loss=0.3827 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:47:38] [INFO] [experiment] Epoch 8/30 (28.37s): train_loss=0.4690, train_top1=0.2375, train_top3=0.9848, val_loss=0.3827 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:48:07] [INFO] [experiment] Epoch 9/30 (28.72s): train_loss=0.4621, train_top1=0.2370, train_top3=0.9892, val_loss=0.3827 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:48:51] [INFO] [experiment] Epoch 10/30 (43.51s): train_loss=0.4597, train_top1=0.2397, train_top3=0.9881, val_loss=0.3917, val_kl=0.1673, val_top1=0.4156, val_top3=0.9545
[2026-01-20 01:49:13] [INFO] [experiment] Computing prediction distribution for epoch 10...
[2026-01-20 01:49:27] [INFO] [experiment] Epoch 10 prediction distribution: ['0.1530', '0.1186', '0.1317', '0.1317', '0.1065', '0.0987', '0.1581', '0.1019']
[2026-01-20 01:49:27] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/prediction_distributions.json
[2026-01-20 01:49:27] [INFO] [experiment] No improvement (val_loss: 0.3917 >= best: 0.3827 - 0.0005). Patience counter: 1/5
[2026-01-20 01:49:27] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_10.pt
[2026-01-20 01:49:55] [INFO] [experiment] Epoch 11/30 (28.16s): train_loss=0.4578, train_top1=0.2337, train_top3=0.9875, val_loss=0.3917 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:50:24] [INFO] [experiment] Epoch 12/30 (28.14s): train_loss=0.4562, train_top1=0.2343, train_top3=0.9875, val_loss=0.3917 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:50:51] [INFO] [experiment] Epoch 13/30 (27.64s): train_loss=0.4548, train_top1=0.2440, train_top3=0.9957, val_loss=0.3917 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:51:19] [INFO] [experiment] Epoch 14/30 (28.05s): train_loss=0.4548, train_top1=0.2294, train_top3=0.9973, val_loss=0.3917 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 02:03:41] [INFO] [experiment] Epoch 15/30 (741.83s): train_loss=0.4539, train_top1=0.2489, train_top3=0.9973, val_loss=0.3904, val_kl=0.1661, val_top1=0.4156, val_top3=0.9610
[2026-01-20 02:08:19] [INFO] [experiment] Computing prediction distribution for epoch 15...
[2026-01-20 02:08:34] [INFO] [experiment] Epoch 15 prediction distribution: ['0.1525', '0.1154', '0.1334', '0.1338', '0.1010', '0.1027', '0.1586', '0.1027']
[2026-01-20 02:08:34] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/prediction_distributions.json
[2026-01-20 02:08:34] [INFO] [experiment] No improvement (val_loss: 0.3904 >= best: 0.3827 - 0.0005). Patience counter: 2/5
[2026-01-20 02:24:38] [INFO] [experiment] Epoch 16/30 (963.48s): train_loss=0.4541, train_top1=0.2451, train_top3=0.9978, val_loss=0.3904 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 02:25:07] [INFO] [experiment] Epoch 17/30 (28.79s): train_loss=0.4538, train_top1=0.2419, train_top3=0.9978, val_loss=0.3904 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 02:41:19] [INFO] [experiment] Epoch 18/30 (972.71s): train_loss=0.4538, train_top1=0.2489, train_top3=0.9978, val_loss=0.3904 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 02:41:48] [INFO] [experiment] Epoch 19/30 (28.31s): train_loss=0.4538, train_top1=0.2392, train_top3=0.9973, val_loss=0.3904 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 02:59:46] [INFO] [experiment] Epoch 20/30 (1077.97s): train_loss=0.4536, train_top1=0.2337, train_top3=0.9978, val_loss=0.3895, val_kl=0.1656, val_top1=0.4156, val_top3=0.9610
[2026-01-20 03:00:08] [INFO] [experiment] Computing prediction distribution for epoch 20...
[2026-01-20 03:16:30] [INFO] [experiment] Epoch 20 prediction distribution: ['0.1521', '0.1131', '0.1347', '0.1344', '0.0995', '0.1041', '0.1583', '0.1038']
[2026-01-20 03:16:30] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/prediction_distributions.json
[2026-01-20 03:16:30] [INFO] [experiment] No improvement (val_loss: 0.3895 >= best: 0.3827 - 0.0005). Patience counter: 3/5
[2026-01-20 03:16:30] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_20.pt
[2026-01-20 03:17:00] [INFO] [experiment] Epoch 21/30 (29.66s): train_loss=0.4535, train_top1=0.2516, train_top3=0.9973, val_loss=0.3895 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 03:34:17] [INFO] [experiment] Epoch 22/30 (1037.10s): train_loss=0.4533, train_top1=0.2484, train_top3=0.9973, val_loss=0.3895 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 03:34:44] [INFO] [experiment] Epoch 23/30 (26.86s): train_loss=0.4531, train_top1=0.2451, train_top3=0.9984, val_loss=0.3895 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 03:35:12] [INFO] [experiment] Epoch 24/30 (28.10s): train_loss=0.4534, train_top1=0.2663, train_top3=0.9973, val_loss=0.3895 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 03:35:55] [INFO] [experiment] Epoch 25/30 (43.07s): train_loss=0.4532, train_top1=0.2435, train_top3=0.9978, val_loss=0.3909, val_kl=0.1662, val_top1=0.4156, val_top3=0.9610
[2026-01-20 03:36:17] [INFO] [experiment] Computing prediction distribution for epoch 25...
[2026-01-20 03:36:31] [INFO] [experiment] Epoch 25 prediction distribution: ['0.1524', '0.1111', '0.1352', '0.1353', '0.0992', '0.1051', '0.1577', '0.1040']
[2026-01-20 03:36:31] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/prediction_distributions.json
[2026-01-20 03:36:31] [INFO] [experiment] No improvement (val_loss: 0.3909 >= best: 0.3827 - 0.0005). Patience counter: 4/5
[2026-01-20 03:36:59] [INFO] [experiment] Epoch 26/30 (27.81s): train_loss=0.4530, train_top1=0.2489, train_top3=0.9973, val_loss=0.3909 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 03:37:27] [INFO] [experiment] Epoch 27/30 (27.97s): train_loss=0.4529, train_top1=0.2674, train_top3=0.9973, val_loss=0.3909 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 03:37:55] [INFO] [experiment] Epoch 28/30 (27.60s): train_loss=0.4529, train_top1=0.2739, train_top3=0.9973, val_loss=0.3909 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 03:38:22] [INFO] [experiment] Epoch 29/30 (27.07s): train_loss=0.4530, train_top1=0.2668, train_top3=0.9973, val_loss=0.3909 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 03:39:05] [INFO] [experiment] Epoch 30/30 (42.78s): train_loss=0.4530, train_top1=0.2749, train_top3=0.9984, val_loss=0.3888, val_kl=0.1651, val_top1=0.4156, val_top3=0.9610
[2026-01-20 03:39:27] [INFO] [experiment] Computing prediction distribution for epoch 30...
[2026-01-20 03:39:42] [INFO] [experiment] Epoch 30 prediction distribution: ['0.1512', '0.1108', '0.1365', '0.1354', '0.0989', '0.1050', '0.1579', '0.1042']
[2026-01-20 03:39:42] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/prediction_distributions.json
[2026-01-20 03:39:42] [INFO] [experiment] No improvement (val_loss: 0.3888 >= best: 0.3827 - 0.0005). Patience counter: 5/5
[2026-01-20 03:39:42] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_30.pt
[2026-01-20 03:39:42] [INFO] [experiment] Early stopping triggered after 30 epochs (patience: 5 validation epochs without improvement)
[2026-01-20 03:39:42] [INFO] [experiment] Evaluating on test set and saving predictions...
[2026-01-20 03:40:05] [INFO] [experiment] Test metrics: loss=0.8275, kl=0.3722, top1=0.3484, top3=0.9791
[2026-01-20 03:40:29] [INFO] [src.evaluation.save_predictions] Saved 1484 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/test_predictions.csv
[2026-01-20 03:40:29] [INFO] [src.evaluation.save_predictions] Saved evaluation results to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/test_evaluation_results.json
[2026-01-20 03:40:29] [INFO] [experiment] Saved test predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/test_predictions.csv
[2026-01-20 03:40:45] [INFO] [src.evaluation.save_predictions] Saved 308 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/val_predictions.csv
[2026-01-20 03:40:45] [INFO] [experiment] Saved validation predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/val_predictions.csv
[2026-01-20 03:40:45] [INFO] [experiment] Generating training plots...
[2026-01-20 03:40:46] [INFO] [src.evaluation.plotting] Saved training curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/plots/training_training_curves.png
[2026-01-20 03:40:46] [INFO] [src.evaluation.plotting] Saved loss comparison to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/plots/training_loss_comparison.png
[2026-01-20 03:40:46] [INFO] [src.evaluation.plotting] Saved accuracy curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/plots/training_accuracy_curves.png
[2026-01-20 03:40:46] [INFO] [src.evaluation.plotting] Saved all training summary plots to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/plots
[2026-01-20 03:40:46] [INFO] [src.evaluation.plotting] Saved neighbor distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/plots/neighbor_distribution.png
[2026-01-20 03:40:47] [INFO] [src.evaluation.plotting] Saved target probability distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/plots/target_probability_distribution.png
[2026-01-20 03:40:47] [INFO] [experiment] Training complete
[2026-01-20 03:40:47] [INFO] [experiment] Best validation loss: 0.3827
[2026-01-20 03:40:47] [INFO] [experiment] Results saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run
[2026-01-20 03:40:47] [INFO] [experiment] Plots saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_3_mild/run/plots
