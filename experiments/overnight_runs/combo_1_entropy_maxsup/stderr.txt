[2026-01-20 00:58:56] [INFO] [experiment] Starting training
[2026-01-20 00:58:56] [INFO] [experiment] Using device: mps
[2026-01-20 00:58:56] [INFO] [experiment] Loading features from data/processed/features/compliant
[2026-01-20 00:58:56] [INFO] [src.training.dataset] Found 7 target_points.parquet files in data/processed/features/compliant
[2026-01-20 00:58:57] [INFO] [src.training.dataset] Combined 3636 total rows from 7 files, 7 unique neighborhoods
[2026-01-20 00:58:57] [INFO] [src.training.dataset] Created splits: Train=1844 rows (4 neighborhoods), Val=308 rows (1 neighborhoods), Test=1484 rows (2 neighborhoods)
[2026-01-20 00:58:57] [INFO] [experiment] Calculating class weights from training dataset...
[2026-01-20 00:58:57] [INFO] [experiment] Class counts: [487, 60, 478, 208, 27, 64, 479, 41]
[2026-01-20 00:58:57] [INFO] [experiment] Class weights (before damping): [3.786447525024414, 30.733333587646484, 3.857740640640259, 8.865385055541992, 68.29629516601562, 28.8125, 3.849686861038208, 44.975608825683594]
[2026-01-20 00:58:57] [INFO] [experiment] Class weights (after sqrt damping and capping at 3.0): [1.945879578590393, 3.0, 1.9641132354736328, 2.9774796962738037, 3.0, 3.0, 1.962061882019043, 3.0]
[2026-01-20 00:58:57] [INFO] [experiment] Data augmentation enabled: feature_noise (p=0.8, std=0.01), neighbor_subsampling (p=0.5, ratio=0.8), edge_noise (p=0.3, std=0.02)
[2026-01-20 00:58:57] [INFO] [experiment] Computing true class distribution from training dataset...
[2026-01-20 00:58:59] [INFO] [experiment] True distribution: ['0.1571', '0.0913', '0.1712', '0.1383', '0.0718', '0.0792', '0.1926', '0.0985']
[2026-01-20 00:58:59] [INFO] [experiment] Created datasets: Train=1844, Val=308, Test=1484
[2026-01-20 00:58:59] [INFO] [src.training.model] Created SpatialGraphTransformer: 47,752 parameters
[2026-01-20 00:58:59] [INFO] [experiment] Loss function: label_smoothing=0.0, class_weights capped at 3.0, entropy_weight=0.5, min_entropy=0.5, entropy_penalty_type=linear, maxsup_weight=0.0, maxsup_threshold=0.0
[2026-01-20 00:58:59] [INFO] [experiment] Optimizer: using separate weight decay - base=0.001, final_layer=0.011
[2026-01-20 00:58:59] [INFO] [experiment] Initialized prediction distribution file: /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/prediction_distributions.json
[2026-01-20 00:58:59] [INFO] [experiment] Starting training loop
[2026-01-20 00:59:46] [INFO] [experiment] Epoch 1/30 (46.58s): train_loss=0.5552, train_top1=0.0146, train_top3=0.8308, val_loss=0.4129, val_kl=0.1889, val_top1=0.0260, val_top3=0.8994
[2026-01-20 01:00:09] [INFO] [experiment] Computing prediction distribution for epoch 1...
[2026-01-20 01:00:23] [INFO] [experiment] Epoch 1 prediction distribution: ['0.1217', '0.1314', '0.1356', '0.1208', '0.1391', '0.1058', '0.1149', '0.1307']
[2026-01-20 01:00:23] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/prediction_distributions.json
[2026-01-20 01:00:23] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:00:23] [INFO] [experiment] New best validation loss: 0.4129 (patience counter reset to 0)
[2026-01-20 01:00:54] [INFO] [experiment] Epoch 2/30 (30.46s): train_loss=0.5416, train_top1=0.2044, train_top3=0.8503, val_loss=0.4129 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:01:24] [INFO] [experiment] Epoch 3/30 (29.68s): train_loss=0.5260, train_top1=0.2706, train_top3=0.8921, val_loss=0.4129 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:01:54] [INFO] [experiment] Epoch 4/30 (30.59s): train_loss=0.5118, train_top1=0.2592, train_top3=0.9046, val_loss=0.4129 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:02:40] [INFO] [experiment] Epoch 5/30 (45.61s): train_loss=0.4987, train_top1=0.2576, train_top3=0.9751, val_loss=0.3796, val_kl=0.1723, val_top1=0.2305, val_top3=0.9610
[2026-01-20 01:03:03] [INFO] [experiment] Computing prediction distribution for epoch 5...
[2026-01-20 01:03:17] [INFO] [experiment] Epoch 5 prediction distribution: ['0.1365', '0.1233', '0.1379', '0.1265', '0.1203', '0.1059', '0.1353', '0.1143']
[2026-01-20 01:03:17] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/prediction_distributions.json
[2026-01-20 01:03:17] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:03:17] [INFO] [experiment] New best validation loss: 0.3796 (patience counter reset to 0)
[2026-01-20 01:03:46] [INFO] [experiment] Epoch 6/30 (29.37s): train_loss=0.4894, train_top1=0.2554, train_top3=0.9870, val_loss=0.3796 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:04:15] [INFO] [experiment] Epoch 7/30 (28.23s): train_loss=0.4831, train_top1=0.2636, train_top3=0.9859, val_loss=0.3796 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:04:43] [INFO] [experiment] Epoch 8/30 (28.67s): train_loss=0.4798, train_top1=0.2554, train_top3=0.9881, val_loss=0.3796 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:05:12] [INFO] [experiment] Epoch 9/30 (28.93s): train_loss=0.4767, train_top1=0.2549, train_top3=0.9892, val_loss=0.3796 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:05:57] [INFO] [experiment] Epoch 10/30 (44.28s): train_loss=0.4757, train_top1=0.2722, train_top3=0.9881, val_loss=0.3757, val_kl=0.1703, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:06:19] [INFO] [experiment] Computing prediction distribution for epoch 10...
[2026-01-20 01:06:33] [INFO] [experiment] Epoch 10 prediction distribution: ['0.1378', '0.1212', '0.1322', '0.1278', '0.1142', '0.1123', '0.1424', '0.1122']
[2026-01-20 01:06:33] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/prediction_distributions.json
[2026-01-20 01:06:33] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:06:33] [INFO] [experiment] New best validation loss: 0.3757 (patience counter reset to 0)
[2026-01-20 01:06:33] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_10.pt
[2026-01-20 01:07:01] [INFO] [experiment] Epoch 11/30 (27.79s): train_loss=0.4749, train_top1=0.2554, train_top3=0.9859, val_loss=0.3757 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:07:29] [INFO] [experiment] Epoch 12/30 (27.96s): train_loss=0.4743, train_top1=0.2630, train_top3=0.9859, val_loss=0.3757 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:07:56] [INFO] [experiment] Epoch 13/30 (26.90s): train_loss=0.4737, train_top1=0.2614, train_top3=0.9967, val_loss=0.3757 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:08:24] [INFO] [experiment] Epoch 14/30 (28.13s): train_loss=0.4737, train_top1=0.2636, train_top3=0.9967, val_loss=0.3757 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:09:07] [INFO] [experiment] Epoch 15/30 (43.49s): train_loss=0.4733, train_top1=0.2625, train_top3=0.9967, val_loss=0.3739, val_kl=0.1694, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:09:30] [INFO] [experiment] Computing prediction distribution for epoch 15...
[2026-01-20 01:09:44] [INFO] [experiment] Epoch 15 prediction distribution: ['0.1368', '0.1200', '0.1303', '0.1290', '0.1125', '0.1142', '0.1442', '0.1129']
[2026-01-20 01:09:44] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/prediction_distributions.json
[2026-01-20 01:09:44] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:09:44] [INFO] [experiment] New best validation loss: 0.3739 (patience counter reset to 0)
[2026-01-20 01:10:12] [INFO] [experiment] Epoch 16/30 (27.22s): train_loss=0.4734, train_top1=0.2641, train_top3=0.9962, val_loss=0.3739 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:10:39] [INFO] [experiment] Epoch 17/30 (27.56s): train_loss=0.4734, train_top1=0.2630, train_top3=0.9962, val_loss=0.3739 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:11:08] [INFO] [experiment] Epoch 18/30 (28.43s): train_loss=0.4733, train_top1=0.2625, train_top3=0.9967, val_loss=0.3739 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:11:35] [INFO] [experiment] Epoch 19/30 (27.07s): train_loss=0.4733, train_top1=0.2592, train_top3=0.9951, val_loss=0.3739 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:12:16] [INFO] [experiment] Epoch 20/30 (41.70s): train_loss=0.4733, train_top1=0.2592, train_top3=0.9962, val_loss=0.3731, val_kl=0.1690, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:12:38] [INFO] [experiment] Computing prediction distribution for epoch 20...
[2026-01-20 01:12:53] [INFO] [experiment] Epoch 20 prediction distribution: ['0.1364', '0.1190', '0.1297', '0.1294', '0.1124', '0.1146', '0.1450', '0.1136']
[2026-01-20 01:12:53] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/prediction_distributions.json
[2026-01-20 01:12:53] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:12:53] [INFO] [experiment] New best validation loss: 0.3731 (patience counter reset to 0)
[2026-01-20 01:12:53] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_20.pt
[2026-01-20 01:13:21] [INFO] [experiment] Epoch 21/30 (28.07s): train_loss=0.4732, train_top1=0.2598, train_top3=0.9962, val_loss=0.3731 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:13:48] [INFO] [experiment] Epoch 22/30 (27.03s): train_loss=0.4731, train_top1=0.2619, train_top3=0.9967, val_loss=0.3731 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:14:14] [INFO] [experiment] Epoch 23/30 (25.95s): train_loss=0.4730, train_top1=0.2625, train_top3=0.9978, val_loss=0.3731 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:14:42] [INFO] [experiment] Epoch 24/30 (28.40s): train_loss=0.4731, train_top1=0.2663, train_top3=0.9962, val_loss=0.3731 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:15:26] [INFO] [experiment] Epoch 25/30 (43.29s): train_loss=0.4730, train_top1=0.2619, train_top3=0.9967, val_loss=0.3735, val_kl=0.1692, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:15:47] [INFO] [experiment] Computing prediction distribution for epoch 25...
[2026-01-20 01:16:02] [INFO] [experiment] Epoch 25 prediction distribution: ['0.1363', '0.1181', '0.1293', '0.1299', '0.1126', '0.1148', '0.1452', '0.1138']
[2026-01-20 01:16:02] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/prediction_distributions.json
[2026-01-20 01:16:02] [INFO] [experiment] No improvement (val_loss: 0.3735 >= best: 0.3731 - 0.0005). Patience counter: 1/5
[2026-01-20 01:16:29] [INFO] [experiment] Epoch 26/30 (27.21s): train_loss=0.4729, train_top1=0.2614, train_top3=0.9967, val_loss=0.3735 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:16:57] [INFO] [experiment] Epoch 27/30 (27.77s): train_loss=0.4729, train_top1=0.2625, train_top3=0.9962, val_loss=0.3735 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:17:24] [INFO] [experiment] Epoch 28/30 (26.80s): train_loss=0.4730, train_top1=0.2641, train_top3=0.9957, val_loss=0.3735 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:17:51] [INFO] [experiment] Epoch 29/30 (27.15s): train_loss=0.4730, train_top1=0.2619, train_top3=0.9946, val_loss=0.3735 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-20 01:18:33] [INFO] [experiment] Epoch 30/30 (42.48s): train_loss=0.4730, train_top1=0.2625, train_top3=0.9973, val_loss=0.3718, val_kl=0.1684, val_top1=0.4156, val_top3=0.9610
[2026-01-20 01:18:55] [INFO] [experiment] Computing prediction distribution for epoch 30...
[2026-01-20 01:19:10] [INFO] [experiment] Epoch 30 prediction distribution: ['0.1354', '0.1180', '0.1299', '0.1299', '0.1126', '0.1147', '0.1455', '0.1140']
[2026-01-20 01:19:10] [INFO] [experiment] Updated prediction distributions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/prediction_distributions.json
[2026-01-20 01:19:10] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-20 01:19:10] [INFO] [experiment] New best validation loss: 0.3718 (patience counter reset to 0)
[2026-01-20 01:19:10] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_30.pt
[2026-01-20 01:19:10] [INFO] [experiment] Evaluating on test set and saving predictions...
[2026-01-20 01:19:32] [INFO] [experiment] Test metrics: loss=0.8580, kl=0.3962, top1=0.3484, top3=0.9791
[2026-01-20 01:19:57] [INFO] [src.evaluation.save_predictions] Saved 1484 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/test_predictions.csv
[2026-01-20 01:19:57] [INFO] [src.evaluation.save_predictions] Saved evaluation results to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/test_evaluation_results.json
[2026-01-20 01:19:57] [INFO] [experiment] Saved test predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/test_predictions.csv
[2026-01-20 01:20:13] [INFO] [src.evaluation.save_predictions] Saved 308 predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/val_predictions.csv
[2026-01-20 01:20:13] [INFO] [experiment] Saved validation predictions to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/val_predictions.csv
[2026-01-20 01:20:13] [INFO] [experiment] Generating training plots...
[2026-01-20 01:20:13] [INFO] [src.evaluation.plotting] Saved training curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/plots/training_training_curves.png
[2026-01-20 01:20:13] [INFO] [src.evaluation.plotting] Saved loss comparison to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/plots/training_loss_comparison.png
[2026-01-20 01:20:13] [INFO] [src.evaluation.plotting] Saved accuracy curves to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/plots/training_accuracy_curves.png
[2026-01-20 01:20:13] [INFO] [src.evaluation.plotting] Saved all training summary plots to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/plots
[2026-01-20 01:20:14] [INFO] [src.evaluation.plotting] Saved neighbor distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/plots/neighbor_distribution.png
[2026-01-20 01:20:14] [INFO] [src.evaluation.plotting] Saved target probability distribution to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/plots/target_probability_distribution.png
[2026-01-20 01:20:14] [INFO] [experiment] Training complete
[2026-01-20 01:20:14] [INFO] [experiment] Best validation loss: 0.3718
[2026-01-20 01:20:14] [INFO] [experiment] Results saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run
[2026-01-20 01:20:14] [INFO] [experiment] Plots saved to /Users/maayanchen/Code/University/AI4SI_Project/experiments/overnight_runs/combo_1_entropy_maxsup/run/plots
