[2026-01-19 16:17:42] [INFO] [experiment] Starting training
[2026-01-19 16:17:42] [INFO] [experiment] Using device: mps
[2026-01-19 16:17:42] [INFO] [experiment] Loading features from data/processed/features/compliant
[2026-01-19 16:17:42] [INFO] [src.training.dataset] Found 7 target_points.parquet files in data/processed/features/compliant
[2026-01-19 16:17:43] [INFO] [src.training.dataset] Combined 3636 total rows from 7 files, 7 unique neighborhoods
[2026-01-19 16:17:43] [INFO] [src.training.dataset] Created splits: Train=1844 rows (4 neighborhoods), Val=308 rows (1 neighborhoods), Test=1484 rows (2 neighborhoods)
[2026-01-19 16:17:43] [INFO] [experiment] Calculating class weights from training dataset...
[2026-01-19 16:17:43] [INFO] [experiment] Class counts: [487, 60, 478, 208, 27, 64, 479, 41]
[2026-01-19 16:17:43] [INFO] [experiment] Class weights (before damping): [3.786447525024414, 30.733333587646484, 3.857740640640259, 8.865385055541992, 68.29629516601562, 28.8125, 3.849686861038208, 44.975608825683594]
[2026-01-19 16:17:43] [INFO] [experiment] Class weights (after sqrt damping and capping at 3.0): [1.945879578590393, 3.0, 1.9641132354736328, 2.9774796962738037, 3.0, 3.0, 1.962061882019043, 3.0]
[2026-01-19 16:17:43] [INFO] [experiment] Computing true class distribution from training dataset...
[2026-01-19 16:17:45] [INFO] [experiment] True distribution: ['0.1571', '0.0913', '0.1712', '0.1383', '0.0718', '0.0792', '0.1926', '0.0985']
[2026-01-19 16:17:45] [INFO] [experiment] Created datasets: Train=1844, Val=308, Test=1484
[2026-01-19 16:17:45] [INFO] [src.training.model] Created SpatialGraphTransformer: 47,752 parameters
[2026-01-19 16:17:45] [INFO] [experiment] Loss function: label_smoothing=0.0, class_weights capped at 3.0
[2026-01-19 16:17:45] [INFO] [experiment] Initialized prediction distribution file: experiments/runs/run_1768832262/prediction_distributions.json
[2026-01-19 16:17:45] [INFO] [experiment] Starting training loop
[2026-01-19 16:18:36] [INFO] [experiment] Epoch 1/100 (50.32s): train_loss=1223.7914, train_top1=0.0136, train_top3=0.6806, val_loss=909.7616, val_kl=15.0647, val_top1=0.0260, val_top3=0.8994
[2026-01-19 16:19:01] [INFO] [experiment] Computing prediction distribution for epoch 1...
[2026-01-19 16:19:16] [INFO] [experiment] Epoch 1 prediction distribution: ['0.0000', '0.0000', '0.0000', '0.0000', '1.0000', '0.0000', '0.0000', '0.0000']
[2026-01-19 16:19:16] [INFO] [experiment] Updated prediction distributions to experiments/runs/run_1768832262/prediction_distributions.json
[2026-01-19 16:19:16] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-19 16:19:16] [INFO] [experiment] New best validation loss: 909.7616
[2026-01-19 16:19:50] [INFO] [experiment] Epoch 2/100 (34.02s): train_loss=815.4245, train_top1=0.0846, train_top3=0.8384, val_loss=909.7616 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:20:24] [INFO] [experiment] Epoch 3/100 (33.81s): train_loss=585.6025, train_top1=0.0982, train_top3=0.8433, val_loss=909.7616 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:20:59] [INFO] [experiment] Epoch 4/100 (35.27s): train_loss=438.0518, train_top1=0.0992, train_top3=0.8487, val_loss=909.7616 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:21:52] [INFO] [experiment] Epoch 5/100 (52.86s): train_loss=318.1089, train_top1=0.1074, train_top3=0.7478, val_loss=1348.6299, val_kl=15.0954, val_top1=0.0455, val_top3=0.8831
[2026-01-19 16:22:18] [INFO] [experiment] Computing prediction distribution for epoch 5...
[2026-01-19 16:22:34] [INFO] [experiment] Epoch 5 prediction distribution: ['1.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000']
[2026-01-19 16:22:34] [INFO] [experiment] Updated prediction distributions to experiments/runs/run_1768832262/prediction_distributions.json
[2026-01-19 16:23:10] [INFO] [experiment] Epoch 6/100 (36.49s): train_loss=240.4060, train_top1=0.1323, train_top3=0.7983, val_loss=1348.6299 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:23:42] [INFO] [experiment] Epoch 7/100 (31.77s): train_loss=193.5609, train_top1=0.1302, train_top3=0.8010, val_loss=1348.6299 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:24:13] [INFO] [experiment] Epoch 8/100 (31.22s): train_loss=152.0410, train_top1=0.1215, train_top3=0.7890, val_loss=1348.6299 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:24:45] [INFO] [experiment] Epoch 9/100 (31.99s): train_loss=95.8753, train_top1=0.1236, train_top3=0.7890, val_loss=1348.6299 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:25:33] [INFO] [experiment] Epoch 10/100 (47.52s): train_loss=68.0131, train_top1=0.1215, train_top3=0.8124, val_loss=1048.2285, val_kl=12.4434, val_top1=0.4156, val_top3=0.9318
[2026-01-19 16:25:58] [INFO] [experiment] Computing prediction distribution for epoch 10...
[2026-01-19 16:26:13] [INFO] [experiment] Epoch 10 prediction distribution: ['0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '1.0000', '0.0000']
[2026-01-19 16:26:13] [INFO] [experiment] Updated prediction distributions to experiments/runs/run_1768832262/prediction_distributions.json
[2026-01-19 16:26:13] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_10.pt
[2026-01-19 16:26:45] [INFO] [experiment] Epoch 11/100 (32.09s): train_loss=38.9803, train_top1=0.1198, train_top3=0.8259, val_loss=1048.2285 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:27:16] [INFO] [experiment] Epoch 12/100 (30.90s): train_loss=24.0505, train_top1=0.1296, train_top3=0.8167, val_loss=1048.2285 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:27:45] [INFO] [experiment] Epoch 13/100 (29.22s): train_loss=24.9360, train_top1=0.1242, train_top3=0.8248, val_loss=1048.2285 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:28:20] [INFO] [experiment] Epoch 14/100 (34.53s): train_loss=25.0878, train_top1=0.1388, train_top3=0.8357, val_loss=1048.2285 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:29:09] [INFO] [experiment] Epoch 15/100 (49.24s): train_loss=21.6654, train_top1=0.1502, train_top3=0.8536, val_loss=972.9451, val_kl=12.4434, val_top1=0.4156, val_top3=0.9318
[2026-01-19 16:29:33] [INFO] [experiment] Computing prediction distribution for epoch 15...
[2026-01-19 16:29:48] [INFO] [experiment] Epoch 15 prediction distribution: ['0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '1.0000', '0.0000']
[2026-01-19 16:29:48] [INFO] [experiment] Updated prediction distributions to experiments/runs/run_1768832262/prediction_distributions.json
[2026-01-19 16:30:19] [INFO] [experiment] Epoch 16/100 (31.14s): train_loss=22.2023, train_top1=0.1372, train_top3=0.8709, val_loss=972.9451 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:30:50] [INFO] [experiment] Epoch 17/100 (30.75s): train_loss=20.0766, train_top1=0.1497, train_top3=0.8856, val_loss=972.9451 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:31:20] [INFO] [experiment] Epoch 18/100 (30.01s): train_loss=23.6304, train_top1=0.1584, train_top3=0.8872, val_loss=972.9451 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:31:49] [INFO] [experiment] Epoch 19/100 (29.25s): train_loss=21.0659, train_top1=0.1486, train_top3=0.9018, val_loss=972.9451 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:32:34] [INFO] [experiment] Epoch 20/100 (44.64s): train_loss=19.4999, train_top1=0.1654, train_top3=0.9008, val_loss=939.3688, val_kl=12.4434, val_top1=0.4156, val_top3=0.9318
[2026-01-19 16:32:59] [INFO] [experiment] Computing prediction distribution for epoch 20...
[2026-01-19 16:33:15] [INFO] [experiment] Epoch 20 prediction distribution: ['0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '1.0000', '0.0000']
[2026-01-19 16:33:15] [INFO] [experiment] Updated prediction distributions to experiments/runs/run_1768832262/prediction_distributions.json
[2026-01-19 16:33:15] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_epoch_20.pt
[2026-01-19 16:33:46] [INFO] [experiment] Epoch 21/100 (30.70s): train_loss=18.6697, train_top1=0.1708, train_top3=0.9176, val_loss=939.3688 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:34:15] [INFO] [experiment] Epoch 22/100 (29.73s): train_loss=20.7798, train_top1=0.1876, train_top3=0.9268, val_loss=939.3688 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:34:44] [INFO] [experiment] Epoch 23/100 (28.19s): train_loss=19.6600, train_top1=0.1990, train_top3=0.9344, val_loss=939.3688 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:35:16] [INFO] [experiment] Epoch 24/100 (32.54s): train_loss=20.6398, train_top1=0.1990, train_top3=0.9235, val_loss=939.3688 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
[2026-01-19 16:36:03] [INFO] [experiment] Epoch 25/100 (46.77s): train_loss=17.4361, train_top1=0.1925, train_top3=0.9311, val_loss=907.5466, val_kl=12.4434, val_top1=0.4156, val_top3=0.9318
[2026-01-19 16:36:27] [INFO] [experiment] Computing prediction distribution for epoch 25...
[2026-01-19 16:36:42] [INFO] [experiment] Epoch 25 prediction distribution: ['0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '1.0000', '0.0000']
[2026-01-19 16:36:42] [INFO] [experiment] Updated prediction distributions to experiments/runs/run_1768832262/prediction_distributions.json
[2026-01-19 16:36:42] [INFO] [src.training.train] Saved checkpoint to models/checkpoints/graph_transformer_best.pt
[2026-01-19 16:36:42] [INFO] [experiment] New best validation loss: 907.5466
[2026-01-19 16:37:12] [INFO] [experiment] Epoch 26/100 (30.09s): train_loss=17.1684, train_top1=0.1838, train_top3=0.9257, val_loss=907.5466 (last), val_kl=N/A, val_top1=N/A, val_top3=N/A
